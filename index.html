<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de apostas</title>
  <style>
    :root{
      --bg:#0b0f14; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#22d3ee; --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b0f14,#0a1420);color:var(--text);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial}
    .wrap{max-width:980px;margin:32px auto;padding:0 16px}
    header{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:20px}
    h1{font-size:clamp(22px,4vw,28px);margin:0}
    .card{background:var(--card);border:1px solid #172033;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.3);overflow:hidden}
    .form{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:16px;padding:20px}
    label{font-weight:600;font-size:14px;color:#cbd5e1}
    input, select{width:100%;margin-top:8px;padding:12px 12px;border-radius:12px;border:1px solid #1f2937;background:#0d1520;color:var(--text);outline:none}
    input:focus, select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(34,211,238,.15)}
    .tip{grid-column:1/-1;font-size:13px;color:var(--muted)}

    .section-title{display:flex;justify-content:space-between;align-items:center;padding:14px 20px;border-bottom:1px solid #1f2937;background:#0f1a2a}
    .section-title h2{margin:0;font-size:clamp(18px,3vw,22px)}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid #1f2937;background:#0d1520}
    .ok{color:var(--good)}
    .warn{color:var(--warn)}
    .err{color:var(--bad)}

    .result{margin-top:18px;padding:0 20px 20px 20}
    .kpis{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px;margin:16px 0}
    .kpis .k{background:#0d1520;border:1px solid #1f2937;border-radius:12px;padding:14px}
    .k .t{font-size:12px;color:var(--muted)}
    .k .v{font-weight:800;margin-top:6px;font-size:18px}

    table{width:100%;border-collapse:separate;border-spacing:0;margin-top:8px;overflow:hidden;border-radius:12px}
    thead th{font-size:13px;text-transform:uppercase;letter-spacing:.04em;color:#9ca3af;background:#0f1a2a;border-bottom:1px solid #1f2937;padding:12px}
    tbody td{padding:12px;border-bottom:1px solid #162133}
    tbody tr:nth-child(even){background:#0d1520}
    tbody tr:last-child td{border-bottom:none}

    footer{margin-top:18px;font-size:12px;color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid #1f2937;background:#0d1520;color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn:hover{border-color:#263445}
    .btn:active{transform:translateY(1px)}

    @media (max-width:720px){
      .form{grid-template-columns:1fr 1fr}
    }
    @media (max-width:480px){
      .form{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- Calculadora de % da banca (AGORA ACIMA) -->
    <section class="card" id="bank-card">
      <div class="section-title">
        <h2>Calculadora de % da Banca</h2>
        <span class="badge">Converte entre % e valor</span>
      </div>
      <form class="form" id="bank-form">
        <div>
          <label> Banca (R$)
            <input id="bankAmount" type="number" step="0.01" min="0" value="100.00" required />
          </label>
        </div>
        <div>
          <label> Percentual (%)
            <input id="bankPercent" type="number" step="0.01" min="0" value="2.00" required />
          </label>
        </div>
        <div>
          <label> Valor correspondente (R$)
            <input id="bankValue" type="number" step="0.01" min="0" placeholder="ex.: 2,00" />
          </label>
        </div>
        <div class="tip">Você pode digitar no <strong>Percentual</strong> <em>ou</em> no <strong>Valor</strong>. Se alterar o valor, a calculadora converte para a <u>porcentagem equivalente</u>; se alterar a porcentagem, converte para o <u>valor</u>.</div>
      </form>
    </section>

    <!-- Calculadora de Martingale -->
    <section class="card" id="martingale-card" style="margin-top:16px">
      <div class="section-title">
        <h2>Calculadora de Martingale</h2>
        <span class="badge">Objetivo: recuperar perdas + lucro alvo</span>
      </div>

      <form class="form" id="form">
        <div>
          <label> Aposta inicial (R$)
            <input id="stake" type="number" step="0.01" min="0.01" value="1.00" required />
          </label>
        </div>
        <div>
          <label> Odds (decimal)
            <input id="odds" type="number" step="0.01" min="1.01" value="1.50" required />
          </label>
        </div>
        <div>
          <label> Níveis de martingale
            <select id="levels">
              <option value="0">0 (apenas aposta inicial)</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3" selected>3</option>
            </select>
          </label>
        </div>
        <div>
          <label> Arredondamento
            <select id="rounding">
              <option value="ceil" selected>Para cima (garante lucro ≥ alvo)</option>
              <option value="nearest">Para 2 casas (pode dar centavos a menos)</option>
            </select>
          </label>
        </div>
        <div class="tip">Preencha a <strong>aposta inicial</strong> e a <strong>odd</strong>. O cálculo ajusta cada martingale para, se vencer naquela etapa, <u>recuperar todas as perdas</u> e ainda lucrar o <em>mesmo valor</em> que você ganharia se tivesse vencido logo na primeira aposta (isto é, <code>aposta × (odds − 1)</code>).</div>
      </form>

      <div class="result" id="result" hidden>
        <div class="kpis">
          <div class="k"><div class="t">Lucro alvo</div><div class="v" id="k-target">–</div></div>
          <div class="k"><div class="t">Exposição total (se perder todos)</div><div class="v" id="k-expo">–</div></div>
          <div class="k"><div class="t">Multiplicador médio por nível</div><div class="v" id="k-multi">–</div></div>
          <div class="k"><div class="t">Risco com Odds baixas</div><div class="v" id="k-risk">–</div></div>
        </div>

        <table>
          <thead>
            <tr>
              <th>Etapa</th>
              <th>Apostar</th>
              <th>Perdido antes</th>
              <th>Lucro líquido se ganhar</th>
              <th>Exposição até aqui</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>

        <div class="row" style="margin-top:12px">
          <button class="btn" id="btnCopy">Copiar tabela</button>
          <button class="btn" id="btnReset">Limpar</button>
        </div>
      </div>
    </section>

    <footer>
      <p> Dica de aposta: fazer apostas no valor de 2,5% da banca inicial, visando lucro de 10% do valor da banca inicial (parar quando atingir o valor da banca inicial + 10% desse valor),  usar o  método Martingale até 2 níveis. </p>
    </footer>
  </div>

  <script>
    const $ = (sel)=>document.querySelector(sel);
    const fmt = new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'});

    function ceil2(x){return Math.ceil((x + 1e-10)*100)/100}
    function round2(x){return Math.round((x + 1e-10)*100)/100}

    function compute(){
      const stake = parseFloat($('#stake').value);
      const odds = parseFloat($('#odds').value);
      const levels = parseInt($('#levels').value,10);
      const rounding = $('#rounding').value;

      const result = $('#result');
      const rows = $('#rows');
      rows.innerHTML = '';

      if(!(stake>0) || !(odds>1)){
        result.hidden = true;
        return;
      }

      const targetProfit = stake*(odds-1); // lucro desejado em qualquer nível

      const bets = [Number.isFinite(stake)?stake:0];
      const roundFn = rounding==='ceil'?ceil2:round2;

      // monta progressão até 3 níveis, respeitando o selecionado
      for(let i=1;i<=levels;i++){
        const L = bets.reduce((a,b)=>a+b,0); // perdas antes do próximo nível (se perdeu todas até aqui)
        const next = roundFn( (L + targetProfit) / (odds - 1) );
        bets.push(next);
      }

      // métricas e tabela
      let cum = 0;
      let multipliers = [];

      for(let i=0;i<bets.length;i++){
        const lostBefore = cum;
        const bet = bets[i];
        const net = roundFn( bet*(odds-1) - lostBefore );
        cum += bet;
        if(i>0 && bets[i-1]>0) multipliers.push(bet/bets[i-1]);

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i===0? 'Inicial' : 'M'+i}</td>
          <td>${fmt.format(bet)}</td>
          <td>${fmt.format(lostBefore)}</td>
          <td>${fmt.format(net)}</td>
          <td>${fmt.format(cum)}</td>
        `;
        rows.appendChild(tr);
      }

      // KPIs
      $('#k-target').textContent = fmt.format(roundFn(targetProfit));
      $('#k-expo').textContent = fmt.format(cum);
      const avgMult = multipliers.length? (multipliers.reduce((a,b)=>a+b,0)/multipliers.length) : 1;
      $('#k-multi').textContent = avgMult.toFixed(2)+'×';

      const riskBadge = document.createElement('span');
      riskBadge.className = 'badge ' + (odds<=1.2? 'err':'warn');
      riskBadge.textContent = odds<=1.2? 'Odds muito baixas → risco alto' : 'Atenção ao risco cumulativo';
      const riskHost = $('#k-risk');
      riskHost.innerHTML = '';
      riskHost.appendChild(riskBadge);

      result.hidden = false;
    }

    // ==== % da banca: sincronia bidirecional ====
    let lastBankEdited = 'bankPercent'; // default
    let updatingBank = false;           // evita loop de eventos

    function computeBank(forceMode){
      const banca = parseFloat($('#bankAmount')?.value);
      const pctEl = $('#bankPercent');
      const valEl = $('#bankValue');

      const pct = parseFloat(pctEl?.value);
      const val = parseFloat(valEl?.value);

      if(!(banca>=0)) return; // nada a fazer
      if(updatingBank) return;
      updatingBank = true;

      const mode = forceMode || lastBankEdited;

      if(mode === 'bankValue'){
        // Valor → %
        const p = banca>0 ? ((val||0)/banca)*100 : 0;
        if(Number.isFinite(p)){
          pctEl.value = round2(p).toFixed(2);
        } else {
          pctEl.value = '';
        }
      } else {
        // % → Valor
        const v = banca * ((pct||0)/100);
        if(Number.isFinite(v)){
          valEl.value = round2(v).toFixed(2);
        } else {
          valEl.value = '';
        }
      }

      updatingBank = false;
    }

    // Eventos
    ['input','change'].forEach(ev=>{
      // Martingale
      $('#form').addEventListener(ev, compute);

      // Banca
      const bf = $('#bank-form');
      if(bf){
        bf.addEventListener(ev, (e)=>{
          const id = e.target?.id;
          if(id === 'bankValue' || id === 'bankPercent' || id === 'bankAmount'){
            lastBankEdited = id === 'bankAmount' ? lastBankEdited : id; // trocar somente se não for a banca
            computeBank(id === 'bankAmount' ? undefined : id);
          }
        });
      }
    });

    // Botões
    $('#btnCopy').addEventListener('click', (e)=>{
      e.preventDefault();
      const headers=['Etapa','Apostar','Perdido antes','Lucro líquido se ganhar','Exposição até aqui'];
      const lines=[headers.join('\t')];
      document.querySelectorAll('#rows tr').forEach(tr=>{
        const tds=[...tr.children].map(td=>td.textContent);
        lines.push(tds.join('\t'));
      });
      const txt=lines.join('\n');
      navigator.clipboard.writeText(txt).then(()=>{
        const btn=e.currentTarget; const old=btn.textContent; btn.textContent='Copiado!'; setTimeout(()=>btn.textContent=old,1200);
      });
    });

    $('#btnReset').addEventListener('click', (e)=>{
      e.preventDefault();
      $('#stake').value='';
      $('#odds').value='';
      $('#levels').value='3';
      compute();
      $('#stake').focus();
    });

    // Inicialização
    window.addEventListener('DOMContentLoaded', () => { compute(); computeBank(); });
  </script>
</body>
</html>
